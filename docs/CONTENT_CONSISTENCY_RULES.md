# 🎯 콘텐츠 일관성 규칙 (Content Consistency Rules)

## 📋 개요
주님말씀AI 웹앱에서 모든 콘텐츠 표시와 상호작용이 일관되게 동작하도록 하는 핵심 규칙들입니다.

## 🎨 UI/UX 일관성 규칙

### 1. **키워드 탭과 개별 탭 완전 동일 동작 원칙**
> **핵심 규칙**: 키워드 탭에서의 모든 콘텐츠 표시와 상호작용은 해당 개별 탭에서의 동작과 **100% 동일**해야 합니다.

#### 🚫 금지사항:
- **페이지 리다이렉트 금지**: 키워드 탭에서 다른 탭으로 이동하는 것은 절대 금지
- **다른 동작 방식 금지**: 키워드 탭과 개별 탭이 다르게 동작하는 것은 일관성 위반

#### ✅ 필수 구현:
- **동일한 모달**: 키워드 탭에서도 개별 탭과 동일한 모달 표시
- **동일한 데이터**: 동일한 API를 사용하여 동일한 데이터 표시
- **동일한 상호작용**: 클릭, 호버, 키보드 동작이 완전히 동일

### 2. **콘텐츠 상세보기 모달 필수 구현**
> **규칙**: 모든 콘텐츠(성경구절, 기도문, 찬송가)는 개별 탭과 키워드 탭에서 동일한 상세보기 모달을 제공해야 합니다.

#### ✅ 구현 요구사항:
- **성경 장**: 클릭 시 해당 장의 모든 구절을 모달에서 표시 (성경 탭과 동일)
- **기도문**: 클릭 시 전체 기도문 내용, 관련 태그 표시
- **찬송가**: 클릭 시 전체 가사, 작곡가, 작사자, 주제, 성경참조 표시

#### 🔒 성경 장 특별 규칙:
- **키워드 탭 성경 부분**: 장 기준 검색 결과 표시 (`/api/bible/search/chapters`)
- **개별 성경 탭**: 장 기준 검색 결과 표시 (`/api/bible/search/chapters`)
- **장 클릭 동작**: 키워드 탭에서도 성경 탭과 동일한 모달로 전체 구절 표시
- **❌ 절대 금지**: 키워드 탭에서 성경 탭으로 리다이렉트하는 동작

#### 📱 모달 디자인 표준:
```html
<!-- 공통 모달 구조 -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9998] hidden">
    <div class="bg-white rounded-3xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <!-- 헤더: 아이콘 + 제목 + 닫기 버튼 -->
        <!-- 내용: 콘텐츠별 상세 정보 -->
        <!-- ESC 키와 배경 클릭으로 닫기 -->
    </div>
</div>
```

### 2. **콘텐츠 카드 클릭 가능성 표시**
> **규칙**: 모든 콘텐츠 카드는 클릭 가능함을 명확히 표시해야 합니다.

#### ✅ 구현 요구사항:
- `cursor-pointer` 클래스 적용
- `hover:shadow-lg transition-shadow` 호버 효과
- 카드 우하단에 "클릭하여 상세보기 →" 안내 텍스트
- 콘텐츠별 색상 구분:
  - 성경구절: `text-blue-600`
  - 기도문: `text-green-600`
  - 찬송가: `text-purple-600`

## 📊 데이터 일관성 규칙

### 3. **API 우선 원칙 (API-First Principle)**
> **규칙**: 모든 콘텐츠는 하드코딩 없이 동일한 API 엔드포인트를 통해서만 가져와야 합니다.

#### ✅ API 일관성 체크리스트:
- **키워드 페이지**와 **개별 탭**이 동일한 API 사용
- 하드코딩된 데이터 금지
- API 응답 형식 표준화

#### 📡 API 엔드포인트 표준:
```javascript
// 성경구절
GET /api/bible/search?q=${keyword}

// 기도문
GET /api/prayers/search?q=${keyword}

// 찬송가
GET /api/hymns/search?q=${keyword}
```

### 4. **데이터 표시 일관성**
> **규칙**: 같은 데이터는 위치에 관계없이 동일하게 표시되어야 합니다.

#### ✅ 데이터 표시 규칙:
- **제목**: 동일한 폰트 크기와 색상
- **내용 미리보기**: `BibleAI.truncate()` 함수로 150자 제한
- **메타데이터**: 작은 글씨로 일관된 위치에 표시
- **카운트**: API에서 받은 실제 데이터 개수 표시

## 🎯 기능 일관성 규칙

### 5. **모달 동작 표준화**
> **규칙**: 모든 모달은 동일한 방식으로 열리고 닫혀야 합니다.

#### ✅ 모달 동작 표준:
- **열기**: 콘텐츠 카드 클릭
- **닫기**: ESC 키, 배경 클릭, X 버튼 클릭
- **로딩**: 데이터 로딩 중 스피너 표시
- **에러**: 실패 시 사용자 친화적 에러 메시지

### 6. **키보드 접근성**
> **규칙**: 모든 상호작용은 키보드로도 가능해야 합니다.

#### ✅ 접근성 요구사항:
- `tabindex="0"` 속성으로 포커스 가능
- `aria-label` 속성으로 스크린 리더 지원
- ESC 키로 모달 닫기
- Enter/Space 키로 카드 클릭

## 🔧 구현 체크리스트

### 새 콘텐츠 타입 추가 시:
- [ ] API 엔드포인트 구현
- [ ] 키워드 페이지에 탭 추가
- [ ] 개별 페이지 생성
- [ ] 상세보기 모달 구현
- [ ] 클릭 가능 카드 디자인 적용
- [ ] 모달 열기/닫기 이벤트 구현
- [ ] 키보드 접근성 지원
- [ ] 에러 처리 구현

### 기존 콘텐츠 수정 시:
- [ ] 키워드 페이지와 개별 탭 동시 수정
- [ ] API 응답 형식 일관성 확인
- [ ] 모달 내용 동기화
- [ ] 사용자 테스트 수행

## 📈 성공 기준

### 데이터 일관성 확인:
```bash
# 동일한 키워드로 API 호출 시 동일한 결과
curl "/api/prayers/search?q=사랑"
curl "/api/bible/search?q=사랑"
curl "/api/hymns/search?q=사랑"
```

### UI 일관성 확인:
- 키워드 페이지에서 "사랑" 선택
- 각 탭의 콘텐츠 클릭하여 모달 확인
- 개별 페이지에서 동일한 콘텐츠 검색하여 비교

## ⚠️ 금지사항

### ❌ 절대 하지 말 것:
1. **하드코딩된 데이터 사용** - 모든 데이터는 API를 통해서만
2. **페이지별 다른 모달** - 동일한 콘텐츠는 동일한 모달
3. **링크 기반 상세보기** - 새 페이지 이동 대신 모달 사용
4. **키워드 탭에서 페이지 리다이렉트** - 키워드 탭 내에서 모달로 완결
5. **일관성 없는 디자인** - 색상, 크기, 레이아웃 표준 준수
6. **접근성 무시** - 키보드 탐색과 스크린 리더 항상 고려

### 🚨 특별 주의사항:
- **성경 장 클릭**: 키워드 탭에서 성경 장을 클릭할 때 성경 탭으로 이동하는 것이 아니라, 키워드 탭 내에서 모달로 전체 구절을 표시해야 함
- **모든 콘텐츠 일관성**: 기도문, 찬송가, 성경 모두 키워드 탭에서 완결되는 경험 제공

## 🔄 지속적 개선

### 정기 점검 항목:
- [ ] 새 콘텐츠 추가 시 규칙 준수 확인
- [ ] 사용자 피드백 반영
- [ ] 성능 최적화
- [ ] 접근성 개선

## 🎯 구현 완료 상태 (2025년 9월 29일)

### ✅ 완전 구현된 규칙들

#### 1. **키워드 탭과 개별 탭 완전 동일 동작 원칙** ✅
- **성경 장 클릭**: 키워드 탭에서 성경 장 클릭 시 모달로 상세보기 (페이지 리다이렉트 금지)
- **API 일관성**: 키워드 탭과 성경 탭 모두 `/api/bible/search/chapters` 사용
- **모달 기능**: ESC 키, 배경 클릭으로 닫기, 구절 복사 기능 완전 동작
- **주제 표시**: `[object Object]` 오류 해결, 정상적인 주제 태그 표시

#### 2. **콘텐츠 상세보기 모달 필수 구현** ✅
- **성경 장**: 키워드 탭에서 성경 탭과 동일한 모달 표시
- **모달 디자인**: 성경 탭과 100% 동일한 구조와 스타일
- **사용자 경험**: 완전한 키보드 접근성과 터치 지원

#### 3. **API 우선 원칙** ✅
- **동일한 API**: 키워드 탭과 개별 탭이 동일한 엔드포인트 사용
- **하드코딩 제거**: JavaScript 하드코딩 없이 API를 통한 데이터 로딩
- **일관된 응답**: 표준화된 JSON 응답 형식 사용

#### 4. **브라우저 캐시 관리** ✅
- **캐시 버전**: 변경사항 반영을 위한 자동 캐시 무효화
- **즉시 반영**: 사용자가 새로고침 없이 최신 기능 사용 가능

### 🔧 구현된 기술적 세부사항

#### 파일별 구현 내용:
- **`/workspace/bibleai/web/templates/pages/bible-analysis.html`**:
  - 성경 장 모달 HTML 구조 추가
  - `viewChapterDetails`, `showChapterModal`, `closeChapterModal`, `copyVerse` 함수 구현
  - ESC 키와 배경 클릭 이벤트 핸들러 추가
  - API 호출을 `/api/bible/search/chapters`로 변경
  - 주제 표시 방식을 성경 탭과 동일하게 수정

- **`/workspace/bibleai/internal/handlers/pages.go`**:
  - 캐시 버전 업데이트 (v4)로 브라우저 캐시 관리

- **`/workspace/bibleai/web/templates/layout/base.html`**:
  - JavaScript 파일에 캐시 버전 파라미터 추가

### 📊 검증된 동작:
- ✅ 키워드 탭에서 성경 장 클릭 시 모달 정상 표시
- ✅ 주제 태그 정상 표시 (`의 (20회)`, `하나님 (9회)` 등)
- ✅ ESC 키로 모달 닫기 동작
- ✅ 배경 클릭으로 모달 닫기 동작
- ✅ 구절 복사 기능 정상 동작
- ✅ 성경 탭과 100% 동일한 사용자 경험

---

**작성일**: 2025년 9월 29일
**최근 업데이트**: 2025년 9월 29일 (키워드 탭 완전 일관성 구현 완료)
**적용 범위**: 주님말씀AI 웹앱 전체
**구현 상태**: 핵심 규칙 완전 구현됨
**업데이트**: 새 기능 추가 시마다 이 문서 업데이트 필수