{{define "bible-analysis.html"}}
{{template "base.html" .}}
{{end}}
{{define "bible-analysis-content"}}
<!-- í‚¤ì›Œë“œ íƒ­ -->
<div id="keywordSelection" class="space-y-6">
    <div class="card">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-primary mb-3">ğŸ” ì˜¤ëŠ˜ì˜ í‚¤ì›Œë“œ</h2>
            <p class="text-lg text-secondary">í‚¤ì›Œë“œë¥¼ ì„ íƒí•˜ì—¬ ê´€ë ¨ ê¸°ë„ë¬¸, ì„±ê²½êµ¬ì ˆ, ì°¬ì†¡ê°€ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
        </div>

        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="keywordsLoading" class="text-center py-12">
            <div class="flex flex-col items-center space-y-4">
                <div class="w-16 h-16 border-4 border-orange-200 border-t-orange-600 rounded-full animate-spin"></div>
                <p class="text-xl text-secondary font-medium">í‚¤ì›Œë“œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>
        </div>

        <!-- í‚¤ì›Œë“œ ê·¸ë¦¬ë“œ -->
        <div id="keywordsContainer" class="keywords-grid hidden">
            <!-- í‚¤ì›Œë“œ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
        </div>
    </div>
</div>

<!-- ë¡œë”© -->
<div id="keywordLoading" class="hidden card text-center py-12">
    <div class="flex flex-col items-center space-y-4">
        <div class="w-16 h-16 border-4 border-orange-200 border-t-orange-600 rounded-full animate-spin"></div>
        <p class="text-xl text-secondary font-medium">ğŸ” ê´€ë ¨ ì½˜í…ì¸ ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</p>
    </div>
</div>

<!-- í‚¤ì›Œë“œ ê²°ê³¼ -->
<div id="keywordContent" class="hidden">
    <div class="card mb-6">
        <div class="flex items-center justify-between mb-6">
            <h3 id="keywordTitle" class="text-2xl font-bold text-primary"></h3>
            <button onclick="resetKeyword()" class="text-lg text-orange-600 hover:text-orange-700 font-medium focus-ring rounded-lg px-4 py-2">
                ğŸ”„ ë‹¤ë¥¸ í‚¤ì›Œë“œ ì„ íƒ
            </button>
        </div>

        <!-- íƒ­ ë²„íŠ¼ -->
        <div class="flex space-x-2 mb-6">
            <button id="prayersTab" onclick="showContentTab('prayers')" class="px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-green-100 text-green-800">
                ğŸ™ ê¸°ë„ë¬¸ <span id="prayersCount" class="ml-1 text-sm opacity-75"></span>
            </button>
            <button id="versesTab" onclick="showContentTab('verses')" class="px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-gray-100 text-gray-700 hover:bg-blue-100 hover:text-blue-800">
                ğŸ“– ì„±ê²½êµ¬ì ˆ <span id="versesCount" class="ml-1 text-sm opacity-75"></span>
            </button>
            <button id="hymnsTab" onclick="showContentTab('hymns')" class="px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-gray-100 text-gray-700 hover:bg-purple-100 hover:text-purple-800">
                ğŸµ ì°¬ì†¡ê°€ <span id="hymnsCount" class="ml-1 text-sm opacity-75"></span>
            </button>
        </div>

        <!-- ì½˜í…ì¸  ì˜ì—­ -->
        <div id="contentArea">
            <div id="prayersContent" class="content-tab">
                <div id="prayersList" class="space-y-4"></div>
            </div>

            <div id="versesContent" class="content-tab hidden">
                <div id="versesList" class="space-y-4"></div>
            </div>

            <div id="hymnsContent" class="content-tab hidden">
                <div id="hymnsList" class="space-y-4"></div>
            </div>
        </div>
    </div>
</div>

<!-- ì„±ê²½êµ¬ì ˆ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
<div id="verseDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9998] hidden">
    <div class="bg-white rounded-3xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mr-4">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                </div>
                <div>
                    <h3 id="verseDetailTitle" class="text-2xl font-bold text-primary"></h3>
                    <p id="verseDetailVersion" class="text-sm text-gray-500"></p>
                </div>
            </div>
            <button onclick="closeVerseDetail()" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="space-y-6">
            <div id="verseDetailContent" class="text-lg leading-relaxed text-gray-700 bg-blue-50 p-6 rounded-xl"></div>
        </div>
    </div>
</div>

<!-- ê¸°ë„ë¬¸ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
<div id="prayerDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9998] hidden">
    <div class="bg-white rounded-3xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mr-4">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                </div>
                <h3 id="prayerDetailTitle" class="text-2xl font-bold text-primary"></h3>
            </div>
            <button onclick="closePrayerDetail()" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="space-y-6">
            <div id="prayerDetailTags" class="flex flex-wrap gap-2"></div>
            <div id="prayerDetailContent" class="text-lg leading-relaxed text-gray-700 bg-green-50 p-6 rounded-xl whitespace-pre-line"></div>
        </div>
    </div>
</div>

<!-- ì°¬ì†¡ê°€ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
<div id="hymnDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9998] hidden">
    <div class="bg-white rounded-3xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mr-4">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                    </svg>
                </div>
                <h3 id="hymnDetailTitle" class="text-2xl font-bold text-primary"></h3>
            </div>
            <button onclick="closeHymnDetail()" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div id="hymnDetailLoading" class="text-center py-12">
            <div class="w-16 h-16 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-lg text-gray-600">ì°¬ì†¡ê°€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
        <div id="hymnDetailContent" class="space-y-6 hidden"></div>
    </div>
</div>

<style>
    /* ë‚˜ì´ë“  ì‚¬ìš©ììš© í‚¤ì›Œë“œ íƒœê·¸ */
    .keyword-tag {
        @apply inline-block bg-orange-100 text-orange-800 px-4 py-2 rounded-xl text-lg font-medium;
        @apply hover:bg-orange-200 transition-colors duration-200;
        @apply focus:ring-4 focus:ring-orange-200 focus:outline-none;
        @apply border-2 border-orange-300 cursor-pointer;
        min-height: 48px;
    }

    /* í‚¤ì›Œë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì¸ë¼ì¸ìœ¼ë¡œ ì´ë™) */

    /* ì½˜í…ì¸  ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .content-card {
        @apply bg-white border border-gray-200 rounded-xl p-4 mb-4;
        @apply hover:shadow-md transition-shadow duration-200;
    }

    /* ì ‘ê·¼ì„± í–¥ìƒ */
    .focus-ring {
        @apply focus:ring-4 focus:ring-blue-400 focus:ring-opacity-50 focus:outline-none;
    }

    /* SPA íƒ­ ì»¨í…ì¸  í‘œì‹œ/ìˆ¨ê¹€ (Tailwind ëŒ€ì²´) */
    .tab-content {
        display: block;
    }
    .tab-content.hidden {
        display: none !important;
        visibility: hidden !important;
    }
    .tab-content.active {
        display: block !important;
        visibility: visible !important;
    }

    /* í‚¤ì›Œë“œ ê·¸ë¦¬ë“œ ìµœì í™” (10ê°œ í‚¤ì›Œë“œìš©) */
    .keywords-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.25rem;
        margin-top: 1.5rem;
    }

    /* íƒ­ ë²„íŠ¼ í™œì„±í™” ìŠ¤íƒ€ì¼ */
    .content-tab.hidden {
        display: none !important;
    }
</style>

<script>
    // ì „ì—­ BibleAI ê°ì²´
    window.BibleAI = {
        api: {
            async get(url) {
                try {
                    const response = await fetch(url);
                    return await response.json();
                } catch (error) {
                    console.error('API GET ì˜¤ë¥˜:', error);
                    throw error;
                }
            },
            async post(url, data) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    return await response.json();
                } catch (error) {
                    console.error('API POST ì˜¤ë¥˜:', error);
                    throw error;
                }
            }
        },
        storage: {
            get: (key) => localStorage.getItem(key),
            set: (key, value) => localStorage.setItem(key, value)
        },
        showNotification(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
        },
        formatDate: (date) => new Intl.DateTimeFormat('ko-KR').format(new Date(date)),
        truncate: (str, length = 100) => str.length > length ? str.substring(0, length) + '...' : str
    };

    // í‚¤ì›Œë“œ ë°ì´í„° (APIì—ì„œ ë¡œë“œ)
    let KEYWORDS = [];

    // í˜„ì¬ ì„ íƒëœ í‚¤ì›Œë“œ
    let currentKeyword = null;
    let currentTab = 'prayers';

    // í•˜ë“œì½”ë”© ì œê±° - ì´ì œ APIë¥¼ í†µí•´ ê¸°ë„ë¬¸ì„ ê°€ì ¸ì˜µë‹ˆë‹¤

    // í˜ì´ì§€ ë¡œë“œ ì‹œ í‚¤ì›Œë“œ ë¡œë”©
    document.addEventListener('DOMContentLoaded', function() {
        loadKeywords();
    });

    // í‚¤ì›Œë“œ ë¡œë”©
    async function loadKeywords() {
        const container = document.getElementById('keywordsContainer');
        const loading = document.getElementById('keywordsLoading');

        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        loading.classList.remove('hidden');
        container.classList.add('hidden');

        try {
            // APIì—ì„œ ì¶”ì²œ í‚¤ì›Œë“œ ê°€ì ¸ì˜¤ê¸°
            const response = await fetch('/api/keywords/featured');
            const data = await response.json();

            if (data.success && data.keywords) {
                KEYWORDS = data.keywords.map(keyword => ({
                    id: keyword.name.toLowerCase(),
                    name: keyword.name,
                    icon: keyword.icon,
                    description: keyword.description,
                    prayer_count: keyword.prayer_count,
                    bible_count: keyword.bible_count,
                    hymn_count: keyword.hymn_count
                }));

                // í‚¤ì›Œë“œ ë²„íŠ¼ ìƒì„± (ì•„ì´ì½˜ ì œê±°, ì™¸ê³½ì„  ì¶”ê°€)
                const keywordButtons = KEYWORDS.map(keyword => `
                    <button onclick="selectKeyword('${keyword.name}')"
                            class="w-full bg-white border-2 border-gray-200 rounded-xl p-4 text-left hover:border-orange-300 hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                            aria-label="${keyword.name} - ${keyword.description}">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="font-bold text-xl text-gray-800 mb-1">${keyword.name}</div>
                                <div class="text-sm text-gray-600 mb-2">${keyword.description}</div>
                                <div class="flex flex-wrap gap-2 text-xs">
                                    <span class="bg-green-100 text-green-700 px-2 py-1 rounded-md">ê¸°ë„ ${keyword.prayer_count}</span>
                                    <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded-md">ì„±ê²½ ${keyword.bible_count}</span>
                                    <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded-md">ì°¬ì†¡ ${keyword.hymn_count}</span>
                                </div>
                            </div>
                            <svg class="w-5 h-5 text-gray-400 ml-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </div>
                    </button>
                `).join('');

                container.innerHTML = keywordButtons;
            } else {
                throw new Error('í‚¤ì›Œë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        } catch (error) {
            console.error('í‚¤ì›Œë“œ ë¡œë”© ì‹¤íŒ¨:', error);
            container.innerHTML = `
                <div class="text-center text-red-600 p-4">
                    <p>í‚¤ì›Œë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                    <button onclick="loadKeywords()" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                        ë‹¤ì‹œ ì‹œë„
                    </button>
                </div>
            `;
        } finally {
            loading.classList.add('hidden');
            container.classList.remove('hidden');
        }
    }

    // í‚¤ì›Œë“œ ì„ íƒ
    async function selectKeyword(keyword) {
        currentKeyword = keyword;

        // UI ì—…ë°ì´íŠ¸
        document.getElementById('keywordSelection').classList.add('hidden');
        document.getElementById('keywordLoading').classList.remove('hidden');
        document.getElementById('keywordContent').classList.add('hidden');

        try {
            // ë³‘ë ¬ë¡œ ëª¨ë“  ì½˜í…ì¸  ë¡œë“œ
            const [prayers, verses, hymns] = await Promise.all([
                loadPrayersByKeyword(keyword),
                loadVersesByKeyword(keyword),
                loadHymnsByKeyword(keyword)
            ]);

            // ê²°ê³¼ í‘œì‹œ
            displayKeywordResults(keyword, prayers, verses, hymns);

        } catch (error) {
            console.error('í‚¤ì›Œë“œ ì½˜í…ì¸  ë¡œë”© ì‹¤íŒ¨:', error);
            BibleAI.showNotification('ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            resetKeyword();
        }
    }

    // ê¸°ë„ë¬¸ ë¡œë”© (API í˜¸ì¶œ)
    async function loadPrayersByKeyword(keyword) {
        try {
            // í‚¤ì›Œë“œ ì´ë¦„ìœ¼ë¡œ ì§ì ‘ ê²€ìƒ‰
            const response = await BibleAI.api.get(`/api/prayers/search?q=${encodeURIComponent(keyword)}`);
            return response.prayers || [];
        } catch (error) {
            console.error('ê¸°ë„ë¬¸ ë¡œë”© ì‹¤íŒ¨:', error);
            return [];
        }
    }

    // ì„±ê²½êµ¬ì ˆ ë¡œë”© (API í˜¸ì¶œ)
    async function loadVersesByKeyword(keyword) {
        try {
            // ì„±ê²½ íƒ­ê³¼ ë™ì¼í•œ ì¥ ê¸°ì¤€ API ì‚¬ìš©
            const response = await BibleAI.api.get(`/api/bible/search/chapters?q=${encodeURIComponent(keyword)}`);
            return response.results || [];
        } catch (error) {
            console.error('ì„±ê²½êµ¬ì ˆ ë¡œë”© ì‹¤íŒ¨:', error);
            return [];
        }
    }

    // ì°¬ì†¡ê°€ ë¡œë”© (API í˜¸ì¶œ)
    async function loadHymnsByKeyword(keyword) {
        try {
            const response = await BibleAI.api.get(`/api/hymns/search?q=${encodeURIComponent(keyword)}`);
            return response.hymns || [];
        } catch (error) {
            console.error('ì°¬ì†¡ê°€ ë¡œë”© ì‹¤íŒ¨:', error);
            return [];
        }
    }

    // í‚¤ì›Œë“œ ê²°ê³¼ í‘œì‹œ
    function displayKeywordResults(keyword, prayers, verses, hymns) {
        document.getElementById('keywordLoading').classList.add('hidden');

        // ì œëª© ì„¤ì •
        document.getElementById('keywordTitle').textContent = `ğŸ” "${keyword}" ê´€ë ¨ ì½˜í…ì¸ `;

        // ì¹´ìš´íŠ¸ ì„¤ì •
        document.getElementById('prayersCount').textContent = `(${prayers.length})`;
        document.getElementById('versesCount').textContent = `(${verses.length})`;
        document.getElementById('hymnsCount').textContent = `(${hymns.length})`;

        // ì½˜í…ì¸  í‘œì‹œ
        displayPrayers(prayers);
        displayVerses(verses);
        displayHymns(hymns);

        // í‚¤ì›Œë“œ ì½˜í…ì¸  ì˜ì—­ í‘œì‹œ
        document.getElementById('keywordContent').classList.remove('hidden');

        // ê¸°ë³¸ì ìœ¼ë¡œ ê¸°ë„ë¬¸ íƒ­ í™œì„±í™”
        showContentTab('prayers');
    }

    // ê¸°ë„ë¬¸ í‘œì‹œ
    function displayPrayers(prayers) {
        const container = document.getElementById('prayersList');
        if (prayers.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500 py-8">í•´ë‹¹ í‚¤ì›Œë“œì˜ ê¸°ë„ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        container.innerHTML = prayers.map((prayer, index) => `
            <div class="content-card cursor-pointer hover:shadow-lg transition-shadow" onclick="showPrayerDetailById(${index})">
                <h4 class="font-bold text-lg text-green-800 mb-2">${prayer.title}</h4>
                <p class="text-gray-700 leading-relaxed">${BibleAI.truncate(prayer.content, 150)}</p>
                <div class="mt-3 text-right">
                    <span class="text-sm text-green-600">í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸° â†’</span>
                </div>
            </div>
        `).join('');

        // ì „ì—­ ë³€ìˆ˜ì— ê¸°ë„ë¬¸ ë°ì´í„° ì €ì¥
        window.currentPrayersData = prayers;
    }

    // ì„±ê²½êµ¬ì ˆ í‘œì‹œ (ì¥ ê¸°ì¤€, ì„±ê²½ íƒ­ê³¼ ë™ì¼)
    function displayVerses(chapters) {
        const container = document.getElementById('versesList');
        if (chapters.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500 py-8">í•´ë‹¹ í‚¤ì›Œë“œì˜ ì„±ê²½ ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        container.innerHTML = chapters.map(chapter => `
            <div class="group relative overflow-hidden bg-gradient-to-br from-blue-50/50 to-white hover:from-blue-100/60 hover:to-blue-50/80 rounded-2xl p-6 border border-blue-100/60 transition-all duration-300 hover:shadow-lg hover:shadow-blue-200/30 hover:-translate-y-0.5 cursor-pointer active:scale-[0.98]" onclick="viewChapterDetails('${chapter.book}', ${chapter.chapter}, '${chapter.book_name}')">
                <div class="relative z-10">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex-1">
                            <h4 class="text-xl font-bold text-gray-800 mb-2">${chapter.book_name} ${chapter.chapter}ì¥</h4>
                            <div class="flex items-center space-x-4 mb-3">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                    ì£¼ì œ: ${chapter.theme}
                                </span>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                    ì—°ê´€ë„: ${chapter.relevance_score}/10
                                </span>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800">
                                    ${chapter.keyword_count}íšŒ ë“±ì¥
                                </span>
                            </div>
                        </div>
                        <div class="flex items-center text-blue-500 group-hover:text-blue-600 transition-colors ml-4">
                            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                            </svg>
                            <span class="text-sm font-medium">ì¥ ì½ê¸°</span>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // ì„±ê²½ ì¥ ìƒì„¸ë³´ê¸° (ì„±ê²½ íƒ­ê³¼ ë™ì¼í•œ ê¸°ëŠ¥)
    window.viewChapterDetails = async function(bookId, chapterNum, bookName) {
        console.log('ì±•í„° ìƒì„¸ë³´ê¸°:', bookId, chapterNum);

        try {
            // í•´ë‹¹ ì±•í„°ì˜ ë‚´ìš©ê³¼ ì£¼ì œ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
            const [chapterResponse, themesResponse] = await Promise.all([
                fetch(`/api/bible/chapters/${bookId}/${chapterNum}`),
                fetch(`/api/bible/chapters/${bookId}/${chapterNum}/themes`)
            ]);

            if (!chapterResponse.ok || !themesResponse.ok) {
                throw new Error('ì±•í„° ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }

            const chapterData = await chapterResponse.json();
            const themesData = await themesResponse.json();

            // í‚¤ì›Œë“œ íƒ­ ë‚´ì—ì„œ ëª¨ë‹¬ í‘œì‹œ
            showChapterModal(chapterData, themesData);

        } catch (error) {
            console.error('ì¥ ìƒì„¸ë³´ê¸° ì‹¤íŒ¨:', error);
            BibleAI.showNotification('ì„±ê²½ ì¥ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        }
    };

    // í˜„ì¬ ëª¨ë‹¬ì— í‘œì‹œëœ ì¥ ì •ë³´ ì €ì¥
    let currentModalChapter = null;

    // ì„±ê²½ ì¥ ëª¨ë‹¬ í‘œì‹œ (ì„±ê²½ íƒ­ê³¼ ë™ì¼)
    function showChapterModal(chapterData, themesData) {
        const modal = document.getElementById('chapterModal');
        const modalTitle = modal.querySelector('#modalChapterTitle');
        const modalThemes = modal.querySelector('#modalThemes');
        const modalContent = modal.querySelector('#modalContent');

        // í˜„ì¬ ì¥ ì •ë³´ ì €ì¥
        currentModalChapter = {
            book_id: chapterData.book,
            book_name: chapterData.book_name,
            chapter: chapterData.chapter,
            prev_chapter: chapterData.prev_chapter,
            next_chapter: chapterData.next_chapter
        };

        modalTitle.textContent = `${chapterData.book_name} ${chapterData.chapter}ì¥`;

        // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        updateNavigationButtons();

        // ì£¼ì œ íƒœê·¸ í‘œì‹œ (ì„±ê²½ íƒ­ê³¼ ë™ì¼í•œ ë°©ì‹)
        if (themesData && themesData.themes && themesData.themes.length > 0) {
            modalThemes.innerHTML = themesData.themes.map(theme => `
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 mr-2 mb-2">
                    ${theme.theme} (${theme.keyword_count}íšŒ)
                </span>
            `).join('');
        } else if (chapterData.commentary && chapterData.commentary.themes) {
            // themes APIê°€ ì—†ì„ ë•Œ commentary.themes ì‚¬ìš©
            try {
                const themes = JSON.parse(chapterData.commentary.themes);
                modalThemes.innerHTML = themes.map(theme => `
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 mr-2 mb-2">
                        ${theme}
                    </span>
                `).join('');
            } catch (e) {
                modalThemes.innerHTML = '';
            }
        } else {
            modalThemes.innerHTML = '';
        }

        // í•´ì„ ì •ë³´ í‘œì‹œ (commentary ê°ì²´ê°€ ìˆëŠ” ê²½ìš°)
        const modalCommentary = modal.querySelector('#modalCommentary');
        if (chapterData.commentary && (chapterData.commentary.title || chapterData.commentary.summary)) {
            const commentary = chapterData.commentary;
            let commentaryHtml = `
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 rounded-xl p-6 border-l-4 border-amber-400">
                    <div class="flex items-center mb-4">
                        <div class="w-8 h-8 bg-amber-400 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                            </svg>
                        </div>
                        <h4 class="text-xl font-bold text-amber-800">ğŸ“– ì¥ í•´ì„</h4>
                    </div>
            `;

            if (commentary.title) {
                commentaryHtml += `
                    <div class="mb-4">
                        <h5 class="text-lg font-semibold text-amber-800 mb-2">ğŸ¯ í•µì‹¬ ì£¼ì œ</h5>
                        <p class="text-amber-700 font-medium text-lg">${commentary.title.replace(/'/g, '&#39;')}</p>
                    </div>
                `;
            }

            if (commentary.summary) {
                commentaryHtml += `
                    <div class="mb-4">
                        <h5 class="text-lg font-semibold text-amber-800 mb-2">ğŸ“ ë‚´ìš© ìš”ì•½</h5>
                        <p class="text-amber-700 leading-relaxed">${commentary.summary.replace(/'/g, '&#39;')}</p>
                    </div>
                `;
            }

            if (commentary.themes) {
                try {
                    const themes = JSON.parse(commentary.themes);
                    if (themes && themes.length > 0) {
                        commentaryHtml += `
                            <div class="mb-4">
                                <h5 class="text-lg font-semibold text-amber-800 mb-2">ğŸ·ï¸ ì£¼ìš” ì£¼ì œ</h5>
                                <div class="flex flex-wrap gap-2">
                                    ${themes.map(theme => `
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-amber-200 text-amber-800">
                                            ${theme}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }
                } catch (e) {
                    // JSON íŒŒì‹± ì‹¤íŒ¨ì‹œ ë¬´ì‹œ
                }
            }

            if (commentary.context) {
                commentaryHtml += `
                    <div class="mb-4">
                        <h5 class="text-lg font-semibold text-amber-800 mb-2">ğŸ›ï¸ ì—­ì‚¬ì  ë°°ê²½</h5>
                        <p class="text-amber-700 leading-relaxed">${commentary.context.replace(/'/g, '&#39;')}</p>
                    </div>
                `;
            }

            if (commentary.application) {
                commentaryHtml += `
                    <div>
                        <h5 class="text-lg font-semibold text-amber-800 mb-2">ğŸ’¡ í˜„ëŒ€ì  ì ìš©</h5>
                        <p class="text-amber-700 leading-relaxed">${commentary.application.replace(/'/g, '&#39;')}</p>
                    </div>
                `;
            }

            commentaryHtml += '</div>';
            modalCommentary.innerHTML = commentaryHtml;
            modalCommentary.classList.remove('hidden');
        } else {
            modalCommentary.classList.add('hidden');
        }

        // êµ¬ì ˆë“¤ í‘œì‹œ (ì„±ê²½ íƒ­ê³¼ ë™ì¼í•œ ë°©ì‹)
        modalContent.innerHTML = chapterData.verses.map(verse => `
            <p class="mb-4 text-lg leading-relaxed">
                <span class="inline-block w-8 text-blue-600 font-medium text-sm">${verse.verse}</span>
                <span class="text-gray-800">${verse.content}</span>
                <button onclick="copyVerse('${verse.content.replace(/'/g, "\\'")}', '${chapterData.book_name} ${chapterData.chapter}:${verse.verse}')" class="ml-2 text-blue-500 hover:text-blue-700 text-sm">ğŸ“‹</button>
            </p>
        `).join('');

        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    // ì„±ê²½ ì¥ ëª¨ë‹¬ ë‹«ê¸°
    window.closeChapterModal = function() {
        const modal = document.getElementById('chapterModal');
        if (modal) {
            modal.classList.add('hidden');
            document.body.style.overflow = '';
            currentModalChapter = null;
        }
    };

    // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateNavigationButtons() {
        const prevBtn = document.getElementById('prevChapterBtn');
        const nextBtn = document.getElementById('nextChapterBtn');

        if (!currentModalChapter) {
            prevBtn.disabled = true;
            nextBtn.disabled = true;
            return;
        }

        // ì´ì „ ì¥ ë²„íŠ¼ (prev_chapterê°€ nullì´ë©´ ë¹„í™œì„±í™”)
        prevBtn.disabled = (currentModalChapter.prev_chapter === null);

        // ë‹¤ìŒ ì¥ ë²„íŠ¼ (next_chapterê°€ nullì´ë©´ ë¹„í™œì„±í™”)
        nextBtn.disabled = (currentModalChapter.next_chapter === null);
    }

    // ì¥ ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜
    window.navigateChapter = async function(direction) {
        if (!currentModalChapter) return;

        // APIì—ì„œ ì œê³µí•˜ëŠ” prev_chapter/next_chapter ì •ë³´ ì‚¬ìš©
        const newChapter = direction === 'prev'
            ? currentModalChapter.prev_chapter
            : currentModalChapter.next_chapter;

        if (newChapter === null) return;

        try {
            // ìƒˆë¡œìš´ ì¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const chapterResponse = await fetch(`/api/bible/chapters/${currentModalChapter.book_id}/${newChapter}`);
            if (!chapterResponse.ok) {
                throw new Error('ì¥ ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨');
            }
            const chapterData = await chapterResponse.json();

            // ëª¨ë‹¬ ì—…ë°ì´íŠ¸ (chapterDataì— ì´ë¯¸ commentary í¬í•¨)
            showChapterModal(chapterData, chapterData);
        } catch (error) {
            console.error('ì¥ ë„¤ë¹„ê²Œì´ì…˜ ì‹¤íŒ¨:', error);
            BibleAI.showNotification('ì¥ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        }
    };

    // êµ¬ì ˆ ë³µì‚¬ ê¸°ëŠ¥
    window.copyVerse = function(content, reference) {
        const textToCopy = `"${content}" - ${reference}`;
        navigator.clipboard.writeText(textToCopy).then(() => {
            BibleAI.showNotification('âœ… êµ¬ì ˆì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }).catch(() => {
            BibleAI.showNotification('âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        });
    };

    // ESC í‚¤ì™€ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸ ì„¤ì •
    document.addEventListener('DOMContentLoaded', function() {
        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const chapterModal = document.getElementById('chapterModal');
                if (chapterModal && !chapterModal.classList.contains('hidden')) {
                    closeChapterModal();
                }
            }
        });

        // ë°°ê²½ í´ë¦­ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        const chapterModal = document.getElementById('chapterModal');
        if (chapterModal) {
            chapterModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeChapterModal();
                }
            });
        }
    });

    // ì°¬ì†¡ê°€ í‘œì‹œ
    function displayHymns(hymns) {
        const container = document.getElementById('hymnsList');
        if (hymns.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500 py-8">í•´ë‹¹ í‚¤ì›Œë“œì˜ ì°¬ì†¡ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        container.innerHTML = hymns.map(hymn => {
            const displayNumber = hymn.new_hymn_number || hymn.number;
            const paddedNumber = String(displayNumber).padStart(3, '0');
            return `
            <div class="content-card cursor-pointer hover:shadow-lg transition-shadow" onclick="showHymnDetail(${displayNumber}, 'ì‹ ì°¬ì†¡ê°€ ${paddedNumber}ì¥ ${hymn.title.replace(/'/g, "\\'")}')">
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-bold text-lg text-purple-800">ì‹ ì°¬ì†¡ê°€ ${paddedNumber}ì¥ - ${hymn.title}</h4>
                </div>
                <p class="text-gray-600 text-sm mb-2">ì£¼ì œ: ${hymn.theme || 'ì¼ë°˜'}</p>
                <p class="text-gray-700 leading-relaxed">${BibleAI.truncate(hymn.lyrics, 150)}</p>
                <div class="mt-3 text-right">
                    <span class="text-sm text-purple-600">í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸° â†’</span>
                </div>
            </div>
            `;
        }).join('');
    }

    // ì„±ê²½êµ¬ì ˆ ìƒì„¸ë³´ê¸° ëª¨ë‹¬
    function showVerseDetail(book, chapter, verse, content, bookName) {
        document.getElementById('verseDetailModal').classList.remove('hidden');
        document.getElementById('verseDetailTitle').textContent = `${bookName} ${chapter}:${verse}`;
        document.getElementById('verseDetailContent').textContent = content;
        document.getElementById('verseDetailVersion').textContent = 'ê°œì—­ê°œì •';
    }

    function closeVerseDetail() {
        document.getElementById('verseDetailModal').classList.add('hidden');
    }

    // ê¸°ë„ë¬¸ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ (ì¸ë±ìŠ¤ ê¸°ë°˜)
    function showPrayerDetailById(index) {
        if (!window.currentPrayersData || !window.currentPrayersData[index]) {
            console.error('ê¸°ë„ë¬¸ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }

        const prayer = window.currentPrayersData[index];
        document.getElementById('prayerDetailModal').classList.remove('hidden');
        document.getElementById('prayerDetailTitle').textContent = prayer.title;
        document.getElementById('prayerDetailContent').textContent = prayer.content;
        document.getElementById('prayerDetailTags').innerHTML = (prayer.tags || []).map(tag => `
            <span class="inline-block bg-green-100 text-green-800 px-3 py-2 rounded-full text-sm font-medium">${tag.name}</span>
        `).join('');
    }

    // ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ í•¨ìˆ˜ (í•„ìš” ì‹œ)
    function showPrayerDetail(id, title, content, tags) {
        document.getElementById('prayerDetailModal').classList.remove('hidden');
        document.getElementById('prayerDetailTitle').textContent = title;
        document.getElementById('prayerDetailContent').textContent = content;
        document.getElementById('prayerDetailTags').innerHTML = (tags || []).map(tag => `
            <span class="inline-block bg-green-100 text-green-800 px-3 py-2 rounded-full text-sm font-medium">${tag.name}</span>
        `).join('');
    }

    function closePrayerDetail() {
        document.getElementById('prayerDetailModal').classList.add('hidden');
    }

    // ì°¬ì†¡ê°€ ìƒì„¸ë³´ê¸° ëª¨ë‹¬
    async function showHymnDetail(number, title) {
        document.getElementById('hymnDetailModal').classList.remove('hidden');
        document.getElementById('hymnDetailTitle').textContent = `${number}ì¥ - ${title}`;
        document.getElementById('hymnDetailLoading').classList.remove('hidden');
        document.getElementById('hymnDetailContent').classList.add('hidden');

        try {
            const response = await BibleAI.api.get(`/api/hymns/${number}`);
            if (response.success && response.hymn) {
                displayHymnDetailContent(response.hymn);
            } else {
                displayHymnDetailError('ì°¬ì†¡ê°€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        } catch (error) {
            console.error('ì°¬ì†¡ê°€ ë¡œë”© ì‹¤íŒ¨:', error);
            displayHymnDetailError('ì°¬ì†¡ê°€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    function displayHymnDetailContent(hymn) {
        document.getElementById('hymnDetailLoading').classList.add('hidden');
        document.getElementById('hymnDetailContent').innerHTML = `
            <div class="space-y-6">
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div><span class="font-medium">ì£¼ì œ:</span> ${hymn.theme || 'ì¼ë°˜'}</div>
                    <div><span class="font-medium">ì‘ê³¡ê°€:</span> ${hymn.composer || 'ë¯¸ìƒ'}</div>
                    <div><span class="font-medium">ì‘ì‚¬ì:</span> ${hymn.author || 'ë¯¸ìƒ'}</div>
                    <div><span class="font-medium">ì„±ê²½ì°¸ì¡°:</span> ${hymn.bible_reference || 'ì—†ìŒ'}</div>
                </div>
                <div>
                    <h5 class="font-bold text-lg mb-3">ê°€ì‚¬</h5>
                    <div class="text-gray-700 leading-loose whitespace-pre-line bg-gray-50 p-4 rounded-lg">
                        ${hymn.lyrics}
                    </div>
                    <!-- ì €ì‘ê¶Œ ì•ˆë‚´ -->
                    <div class="mt-4 p-4 bg-orange-50 border border-orange-200 rounded-xl">
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-orange-500 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <div class="text-sm text-orange-800">
                                <p class="font-medium mb-1">ğŸ“– ì €ì‘ê¶Œ ì•ˆë‚´</p>
                                <p class="mb-2">ë³¸ ê°€ì‚¬ëŠ” <strong>êµìœ¡ ë° ì°¸ê³  ëª©ì </strong>ìœ¼ë¡œ ì¼ë¶€ ë‚´ìš©ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</p>
                                <p class="text-xs text-orange-600">ì™„ì „í•œ ê°€ì‚¬ëŠ” <strong>í•œêµ­ì°¬ì†¡ê°€ê³µíšŒ</strong> ê³µì‹ ìë£Œë¥¼ ì°¸ì¡°í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.getElementById('hymnDetailContent').classList.remove('hidden');
    }

    function displayHymnDetailError(message) {
        document.getElementById('hymnDetailLoading').classList.add('hidden');
        document.getElementById('hymnDetailContent').innerHTML = `
            <div class="text-center py-12">
                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-700 mb-3">ì°¬ì†¡ê°€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
                <p class="text-gray-500">${message}</p>
            </div>
        `;
        document.getElementById('hymnDetailContent').classList.remove('hidden');
    }

    function closeHymnDetail() {
        document.getElementById('hymnDetailModal').classList.add('hidden');
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ê³¼ ESC í‚¤ ì´ë²¤íŠ¸
    document.addEventListener('click', function(e) {
        if (e.target.id === 'verseDetailModal') closeVerseDetail();
        if (e.target.id === 'prayerDetailModal') closePrayerDetail();
        if (e.target.id === 'hymnDetailModal') closeHymnDetail();
    });

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeVerseDetail();
            closePrayerDetail();
            closeHymnDetail();
        }
    });

    // íƒ­ ì „í™˜
    function showContentTab(tabName) {
        currentTab = tabName;

        // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
        document.querySelectorAll('[id$="Tab"]').forEach(tab => {
            tab.className = 'px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-gray-100 text-gray-700 hover:bg-gray-200';
        });

        // ëª¨ë“  ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
        document.querySelectorAll('.content-tab').forEach(content => {
            content.classList.add('hidden');
        });

        // ì„ íƒëœ íƒ­ í™œì„±í™”
        const activeTab = document.getElementById(`${tabName}Tab`);
        const activeContent = document.getElementById(`${tabName}Content`);

        if (tabName === 'prayers') {
            activeTab.className = 'px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-green-100 text-green-800';
        } else if (tabName === 'verses') {
            activeTab.className = 'px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-blue-100 text-blue-800';
        } else if (tabName === 'hymns') {
            activeTab.className = 'px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-purple-100 text-purple-800';
        }

        activeContent.classList.remove('hidden');
    }

    // í‚¤ì›Œë“œ ë¦¬ì…‹
    function resetKeyword() {
        currentKeyword = null;
        document.getElementById('keywordSelection').classList.remove('hidden');
        document.getElementById('keywordLoading').classList.add('hidden');
        document.getElementById('keywordContent').classList.add('hidden');
    }
</script>

<!-- ì„±ê²½ ì¥ ìƒì„¸ ëª¨ë‹¬ (ì„±ê²½ íƒ­ê³¼ ë™ì¼) -->
<div id="chapterModal" class="fixed inset-0 bg-black bg-opacity-50 z-[9998] hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
        <div class="sticky top-0 bg-white border-b-2 border-gray-200 p-6 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <button id="prevChapterBtn" onclick="navigateChapter('prev')" class="p-2 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="ì´ì „ ì¥">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h3 id="modalChapterTitle" class="text-2xl font-bold text-gray-800"></h3>
                <button id="nextChapterBtn" onclick="navigateChapter('next')" class="p-2 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="ë‹¤ìŒ ì¥">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
            <button onclick="closeChapterModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="p-6 overflow-y-auto max-h-[80vh]">
            <div class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mb-3">ì£¼ìš” ì£¼ì œ</h4>
                <div id="modalThemes" class="flex flex-wrap gap-2">
                    <!-- ì£¼ì œ íƒœê·¸ë“¤ì´ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
                </div>
            </div>
            <div id="modalCommentary" class="mb-6 hidden">
                <!-- í•´ì„ ì •ë³´ê°€ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
            </div>
            <div class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mb-4">ğŸ“– ë³¸ë¬¸</h4>
                <div id="modalContent" class="space-y-4">
                    <!-- ì„±ê²½ êµ¬ì ˆë“¤ì´ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>
</div>
{{end}}