{{define "a-prayers.html"}}
{{template "base.html" .}}
{{end}}
{{define "prayers-content"}}
<!-- í‚¤ì›Œë“œ íƒ­ -->
<div id="keywordSelection" class="space-y-6">
    <div class="card">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-primary mb-3">ğŸ™ í‚¤ì›Œë“œë³„ ê¸°ë„ë¬¸</h2>
            <p class="text-lg text-secondary">í‚¤ì›Œë“œë¥¼ ì„ íƒí•˜ì—¬ ê´€ë ¨ ê¸°ë„ë¬¸ì„ ì°¾ì•„ë³´ì„¸ìš”</p>
        </div>

        <!-- í•µì‹¬ ê¸°ë„ë¬¸ ì„¹ì…˜ (ì‘ì€ í¬ê¸°ë¡œ) -->
        <div class="mb-8 pb-6 border-b-2 border-gray-200">
            <h3 class="text-xl font-bold text-green-700 mb-4">í•µì‹¬ ê¸°ë„ë¬¸</h3>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="showCorePreayer('ì£¼ê¸°ë„ë¬¸')"
                        class="w-full bg-green-50 border-2 border-green-200 rounded-xl p-3 text-left hover:border-green-300 hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <div class="font-bold text-lg text-gray-800 mb-1">ì£¼ê¸°ë„ë¬¸</div>
                    <div class="text-xs text-gray-600">ì˜ˆìˆ˜ë‹˜ì˜ ê°€ë¥´ì¹¨</div>
                </button>

                <button onclick="showCorePreayer('ì‚¬ë„ì‹ ê²½')"
                        class="w-full bg-green-50 border-2 border-green-200 rounded-xl p-3 text-left hover:border-green-300 hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <div class="font-bold text-lg text-gray-800 mb-1">ì‚¬ë„ì‹ ê²½</div>
                    <div class="text-xs text-gray-600">ì‹ ì•™ê³ ë°±</div>
                </button>
            </div>
        </div>

        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="keywordsLoading" class="text-center py-12">
            <div class="flex flex-col items-center space-y-4">
                <div class="w-16 h-16 border-4 border-green-200 border-t-green-600 rounded-full animate-spin"></div>
                <p class="text-xl text-secondary font-medium">í‚¤ì›Œë“œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>
        </div>

        <!-- í‚¤ì›Œë“œ ê·¸ë¦¬ë“œ -->
        <div id="keywordsContainer" class="keywords-grid hidden">
            <!-- í‚¤ì›Œë“œ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
        </div>
    </div>
</div>

<!-- ë¡œë”© -->
<div id="keywordLoading" class="hidden card text-center py-12">
    <div class="flex flex-col items-center space-y-4">
        <div class="w-16 h-16 border-4 border-green-200 border-t-green-600 rounded-full animate-spin"></div>
        <p class="text-xl text-secondary font-medium">ğŸ” ê´€ë ¨ ì½˜í…ì¸ ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</p>
    </div>
</div>

<!-- í‚¤ì›Œë“œ ê²°ê³¼ -->
<div id="keywordContent" class="hidden">
    <div class="card mb-6">
        <div class="flex items-center justify-between mb-6">
            <h3 id="keywordTitle" class="text-2xl font-bold text-primary"></h3>
            <button onclick="resetKeyword()" class="text-lg text-green-600 hover:text-green-700 font-medium focus-ring rounded-lg px-4 py-2">
                ğŸ”„ ë‹¤ë¥¸ í‚¤ì›Œë“œ ì„ íƒ
            </button>
        </div>

        <!-- ê¸°ë„ë¬¸ ì¹´ìš´íŠ¸ í‘œì‹œ -->
        <div class="mb-4">
            <span class="inline-block px-4 py-2 bg-green-100 text-green-800 rounded-lg font-medium">
                ğŸ™ ê¸°ë„ë¬¸ <span id="prayersCount" class="ml-1"></span>
            </span>
        </div>

        <!-- ì½˜í…ì¸  ì˜ì—­ (ê¸°ë„ë¬¸ë§Œ) -->
        <div id="contentArea">
            <div id="prayersList" class="space-y-4"></div>
        </div>
    </div>
</div>

<!-- ì„±ê²½êµ¬ì ˆ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
<div id="verseDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9998] hidden">
    <div class="bg-white rounded-3xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mr-4">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                </div>
                <div>
                    <h3 id="verseDetailTitle" class="text-2xl font-bold text-primary"></h3>
                    <p id="verseDetailVersion" class="text-sm text-gray-500"></p>
                </div>
            </div>
            <button onclick="closeVerseDetail()" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="space-y-6">
            <div id="verseDetailContent" class="text-lg leading-relaxed text-gray-700 bg-blue-50 p-6 rounded-xl"></div>
        </div>
    </div>
</div>

<!-- ê°œì„ ëœ ê¸°ë„ë¬¸ ìƒì„¸ ëª¨ë‹¬ -->
<div id="prayerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-[9998]" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-xl">
            <div class="sticky top-0 bg-white border-b-2 border-gray-200 p-6 flex items-center justify-between rounded-t-2xl">
                <h3 id="modalTitle" class="text-2xl font-bold text-primary"></h3>
                <button onclick="closePrayerModal()" class="p-2 text-disabled hover:text-secondary focus-ring rounded-xl"
                        aria-label="ê¸°ë„ë¬¸ ë‹«ê¸°">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="p-6">
                <div id="modalTags" class="flex flex-wrap gap-2 mb-6"></div>
                <div id="modalContent" class="text-primary text-lg leading-loose whitespace-pre-line">
                    <!-- ê¸°ë„ë¬¸ ë‚´ìš©ì´ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
                </div>
                
                <div class="mt-8 pt-6 border-t-2 border-gray-200">
                    <button onclick="copyPrayer()" class="btn-secondary w-full text-lg py-4 focus-ring" 
                            aria-label="ê¸°ë„ë¬¸ ë³µì‚¬í•˜ê¸°">
                        <svg class="w-5 h-5 inline-block mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
                        </svg>
                        ğŸ“‹ ê¸°ë„ë¬¸ ë³µì‚¬í•˜ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* ë‚˜ì´ë“  ì‚¬ìš©ìë¥¼ ìœ„í•œ ê°œì„ ëœ íƒœê·¸ ë²„íŠ¼ */
.tag-btn {
    @apply flex items-center justify-center px-6 py-5 bg-gray-100 text-primary border-2 border-gray-300 rounded-xl;
    @apply hover:bg-green-100 hover:text-green-700 hover:border-green-400;
    @apply active:bg-green-200 focus:ring-4 focus:ring-green-200 focus:outline-none;
    @apply transition-all duration-200 font-medium;
    min-height: 70px; /* ë” í° í„°ì¹˜ ì˜ì—­ */
}

.tag-btn.selected {
    @apply bg-green-600 text-white border-green-600 hover:bg-green-700 hover:border-green-700;
}

.tag-btn:disabled {
    @apply bg-gray-200 text-disabled border-gray-200 cursor-not-allowed;
    @apply hover:bg-gray-200 hover:text-disabled hover:border-gray-200;
}

/* ì„ íƒëœ íƒœê·¸ ìŠ¤íƒ€ì¼ ê°œì„  */
.selected-tag {
    @apply inline-flex items-center bg-green-100 text-green-800 px-4 py-3 rounded-xl text-base font-medium border-2 border-green-200;
}

.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* ì½˜í…ì¸  ì¹´ë“œ ìŠ¤íƒ€ì¼ (í‚¤ì›Œë“œ íƒ­ê³¼ ë™ì¼) */
.content-card {
    @apply bg-white border border-gray-200 rounded-xl p-4 mb-4;
    @apply hover:shadow-md transition-shadow duration-200;
}

/* ê¸°ë„ë¬¸ ì¹´ë“œ ê°œì„  */
.prayer-card {
    @apply bg-white rounded-xl shadow-md p-6 border-2 border-gray-200;
    @apply hover:shadow-lg hover:border-gray-300 transition-all duration-200;
    @apply cursor-pointer focus:ring-4 focus:ring-green-200 focus:outline-none;
}

/* ì ‘ê·¼ì„± í–¥ìƒ */
.focus-ring {
    @apply focus:ring-4 focus:ring-blue-400 focus:ring-opacity-50 focus:outline-none;
}
</style>

<style>
/* í‚¤ì›Œë“œ ê·¸ë¦¬ë“œ */
.keywords-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

@media (min-width: 768px) {
    .keywords-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* ì½˜í…ì¸  ì¹´ë“œ ìŠ¤íƒ€ì¼ (í‚¤ì›Œë“œ íƒ­ê³¼ ë™ì¼) */
.content-card {
    @apply bg-white border border-gray-200 rounded-xl p-4 mb-4;
    @apply hover:shadow-md transition-shadow duration-200;
}

/* ì ‘ê·¼ì„± í–¥ìƒ */
.focus-ring {
    @apply focus:ring-4 focus:ring-blue-400 focus:ring-opacity-50 focus:outline-none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let currentKeyword = null;

    // í˜ì´ì§€ ë¡œë“œ ì‹œ í‚¤ì›Œë“œ ë¡œë“œ
    loadKeywords();

    async function loadKeywords() {
        try {
            const data = await BibleAI.api.get('/api/keywords/featured');

            if (data.success && data.keywords) {
                displayKeywords(data.keywords);
            } else {
                console.error('í‚¤ì›Œë“œ ë¡œë“œ ì‹¤íŒ¨:', data);
                displayKeywordError();
            }
        } catch (error) {
            console.error('í‚¤ì›Œë“œ API í˜¸ì¶œ ì‹¤íŒ¨:', error);
            displayKeywordError();
        }
    }

    function displayKeywords(keywords) {
        const container = document.getElementById('keywordsContainer');
        const loading = document.getElementById('keywordsLoading');

        const keywordButtons = keywords.map(keyword => `
            <button onclick="selectKeyword('${keyword.name}')"
                    class="w-full bg-white border-2 border-gray-200 rounded-xl p-4 text-left hover:border-green-300 hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                <div class="text-lg font-bold text-gray-800 mb-2">${keyword.name}</div>
                <div class="flex gap-2 flex-wrap">
                    <span class="bg-green-100 text-green-700 px-2 py-1 rounded-md text-xs">ê¸°ë„ë¬¸ ${keyword.prayer_count}ê°œ</span>
                </div>
            </button>
        `).join('');

        container.innerHTML = keywordButtons;
        container.classList.remove('hidden');
        loading.classList.add('hidden');
    }

    function displayKeywordError() {
        const container = document.getElementById('keywordsContainer');
        const loading = document.getElementById('keywordsLoading');

        container.innerHTML = `
            <div class="col-span-full text-center py-8">
                <p class="text-xl text-gray-600 mb-4">í‚¤ì›Œë“œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                <button onclick="loadKeywords()" class="btn-secondary">ë‹¤ì‹œ ì‹œë„</button>
            </div>
        `;
        container.classList.remove('hidden');
        loading.classList.add('hidden');
    }

    window.selectKeyword = async function(keyword) {
        currentKeyword = keyword;

        // UI ì „í™˜
        document.getElementById('keywordSelection').classList.add('hidden');
        document.getElementById('keywordLoading').classList.remove('hidden');
        document.getElementById('keywordTitle').textContent = `"${keyword}" ê´€ë ¨ ì½˜í…ì¸ `;

        try {
            // í‚¤ì›Œë“œ ì´ë¦„ìœ¼ë¡œ ê¸°ë„ë¬¸ ê²€ìƒ‰ (ì œëª©ê³¼ ë‚´ìš©ì—ì„œ ê²€ìƒ‰)
            const prayersResponse = await fetch(`/api/prayers/search?q=${encodeURIComponent(keyword)}`);
            const prayersData = await prayersResponse.json();

            // ê¸°ë„ë¬¸ ë°ì´í„°ë§Œ ì €ì¥
            window.prayersData = prayersData.prayers || [];

            // ê¸°ë„ë¬¸ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            updatePrayerCount(window.prayersData.length);

            // ê¸°ë„ë¬¸ í‘œì‹œ
            displayPrayers(window.prayersData);

            // UI ì „í™˜
            document.getElementById('keywordLoading').classList.add('hidden');
            document.getElementById('keywordContent').classList.remove('hidden');

        } catch (error) {
            console.error('í‚¤ì›Œë“œ ì½˜í…ì¸  ë¡œë“œ ì‹¤íŒ¨:', error);
            BibleAI.showNotification('ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');

            document.getElementById('keywordLoading').classList.add('hidden');
            document.getElementById('keywordSelection').classList.remove('hidden');
        }
    };

    function updatePrayerCount(prayersCount) {
        document.getElementById('prayersCount').textContent = `(${prayersCount})`;
    }

    function displayPrayers(prayers) {
        const container = document.getElementById('prayersList');

        if (prayers.length === 0) {
            container.innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <div class="text-4xl mb-4">ğŸ™</div>
                    <p>í•´ë‹¹ í‚¤ì›Œë“œì˜ ê¸°ë„ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
            `;
            return;
        }

        container.innerHTML = prayers.map((prayer, index) => `
            <div class="content-card cursor-pointer" onclick="showPrayerDetail(${index})">
                <h4 class="font-bold text-lg text-green-800 mb-2">${prayer.title}</h4>
                <p class="text-gray-700 leading-relaxed">${BibleAI.truncate(prayer.content, 150)}</p>
                <div class="mt-3 text-right">
                    <span class="text-sm text-green-600">ìì„¸íˆ ë³´ê¸° â†’</span>
                </div>
            </div>
        `).join('');
    }

    function displayVerses(verses) {
        const container = document.getElementById('versesList');

        if (verses.length === 0) {
            container.innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <div class="text-4xl mb-4">ğŸ“–</div>
                    <p>í•´ë‹¹ í‚¤ì›Œë“œì˜ ì„±ê²½êµ¬ì ˆì´ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
            `;
            return;
        }

        container.innerHTML = verses.map((chapter, index) => `
            <div class="content-card cursor-pointer" onclick="showVerseDetail('${chapter.book}', ${chapter.chapter})">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-bold text-lg text-blue-800">${chapter.book_name} ${chapter.chapter}ì¥</h4>
                    <span class="text-sm text-blue-600 bg-blue-100 px-2 py-1 rounded">${chapter.verse_count}ì ˆ</span>
                </div>
                <div class="space-y-2">
                    ${chapter.themes && chapter.themes.length > 0 ?
                        chapter.themes.map(theme => `<span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs mr-1">${theme}</span>`).join('') :
                        '<span class="text-gray-500 text-sm">ì£¼ì œ ì •ë³´ ì—†ìŒ</span>'
                    }
                </div>
                <div class="mt-3 text-right">
                    <span class="text-sm text-blue-600">ì¥ ì½ê¸° â†’</span>
                </div>
            </div>
        `).join('');
    }

    function displayHymns(hymns) {
        const container = document.getElementById('hymnsList');

        if (hymns.length === 0) {
            container.innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <div class="text-4xl mb-4">ğŸµ</div>
                    <p>í•´ë‹¹ í‚¤ì›Œë“œì˜ ì°¬ì†¡ê°€ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
            `;
            return;
        }

        container.innerHTML = hymns.map(hymn => `
            <div class="content-card cursor-pointer" onclick="showHymnDetail(${hymn.number})">
                <div class="flex items-center justify-between mb-2">
                    <h4 class="font-bold text-lg text-purple-800">${hymn.number}ì¥. ${hymn.title}</h4>
                    <span class="text-sm text-purple-600">${hymn.new_hymn_number}ì¥</span>
                </div>
                <p class="text-gray-600 text-sm mb-2">${hymn.theme || 'í…Œë§ˆ ì—†ìŒ'}</p>
                <div class="text-gray-500 text-sm mb-3">
                    ${hymn.composer ? `ì‘ê³¡: ${hymn.composer}` : ''}
                    ${hymn.author && hymn.composer ? ' â€¢ ' : ''}
                    ${hymn.author ? `ì‘ì‚¬: ${hymn.author}` : ''}
                </div>
                <div class="mt-3 text-right">
                    <span class="text-sm text-purple-600">ê°€ì‚¬ ë³´ê¸° â†’</span>
                </div>
            </div>
        `).join('');
    }

    // í•µì‹¬ ê¸°ë„ë¬¸ í‘œì‹œ í•¨ìˆ˜
    window.showCorePreayer = function(prayerType) {
        const corePreyers = {
            'ì£¼ê¸°ë„ë¬¸': {
                title: 'ì£¼ê¸°ë„ë¬¸',
                content: `í•˜ëŠ˜ì— ê³„ì‹  ìš°ë¦¬ ì•„ë²„ì§€ì—¬
ì´ë¦„ì´ ê±°ë£©íˆ ì—¬ê¹€ì„ ë°›ìœ¼ì‹œì˜¤ë©°
ë‚˜ë¼ê°€ ì„í•˜ì‹œì˜¤ë©°
ëœ»ì´ í•˜ëŠ˜ì—ì„œ ì´ë£¨ì–´ì§„ ê²ƒ ê°™ì´
ë•…ì—ì„œë„ ì´ë£¨ì–´ì§€ì´ë‹¤

ì˜¤ëŠ˜ ìš°ë¦¬ì—ê²Œ ì¼ìš©í•  ì–‘ì‹ì„ ì£¼ì‹œì˜µê³ 
ìš°ë¦¬ê°€ ìš°ë¦¬ì—ê²Œ ì£„ ì§€ì€ ìë¥¼
ì‚¬í•˜ì—¬ ì¤€ ê²ƒ ê°™ì´
ìš°ë¦¬ ì£„ë¥¼ ì‚¬í•˜ì—¬ ì£¼ì‹œì˜µê³ 

ìš°ë¦¬ë¥¼ ì‹œí—˜ì— ë“¤ê²Œ í•˜ì§€ ë§ˆì‹œì˜µê³ 
ë‹¤ë§Œ ì•…ì—ì„œ êµ¬í•˜ì‹œì˜µì†Œì„œ

ëŒ€ê°œ ë‚˜ë¼ì™€ ê¶Œì„¸ì™€ ì˜ê´‘ì´
ì•„ë²„ì§€ê»˜ ì˜ì›íˆ ìˆì‚¬ì˜µë‚˜ì´ë‹¤

ì•„ë©˜`,
                tags: ['ì‹ ì•™', 'ê¸°ë³¸', 'ì˜ˆìˆ˜ë‹˜ì˜ ê°€ë¥´ì¹¨']
            },
            'ì‚¬ë„ì‹ ê²½': {
                title: 'ì‚¬ë„ì‹ ê²½',
                content: `ì „ëŠ¥í•˜ì‚¬ ì²œì§€ë¥¼ ë§Œë“œì‹  í•˜ë‚˜ë‹˜ ì•„ë²„ì§€ë¥¼ ë‚´ê°€ ë¯¿ì‚¬ì˜¤ë©°

ê·¸ ì™¸ì•„ë“¤ ìš°ë¦¬ ì£¼ ì˜ˆìˆ˜ ê·¸ë¦¬ìŠ¤ë„ë¥¼ ë¯¿ì‚¬ì˜¤ë‹ˆ
ì´ëŠ” ì„±ë ¹ìœ¼ë¡œ ì‰íƒœí•˜ì‚¬ ë™ì •ë…€ ë§ˆë¦¬ì•„ì—ê²Œ ë‚˜ì‹œê³ 
ë³¸ë””ì˜¤ ë¹Œë¼ë„ì—ê²Œ ê³ ë‚œì„ ë°›ìœ¼ì‚¬
ì‹­ìê°€ì— ëª» ë°•í˜€ ì£½ìœ¼ì‹œê³ 
ìŒë¶€ì— ë‚´ë ¤ê°€ì…¨ë‹¤ê°€
ì‚¬í˜ ë§Œì— ì£½ì€ ì ê°€ìš´ë°ì„œ ë‹¤ì‹œ ì‚´ì•„ë‚˜ì‹œë©°
í•˜ëŠ˜ì— ì˜¤ë¥´ì‚¬ ì „ëŠ¥í•˜ì‹  í•˜ë‚˜ë‹˜ ìš°í¸ì— ì•‰ì•„ ê³„ì‹œë‹¤ê°€
ì €ë¦¬ë¡œì„œ ì‚° ìì™€ ì£½ì€ ìë¥¼ ì‹¬íŒí•˜ëŸ¬ ì˜¤ì‹œë¦¬ë¼

ì„±ë ¹ì„ ë¯¿ì‚¬ì˜¤ë©°
ê±°ë£©í•œ ê³µíšŒì™€ ì„±ë„ê°€ ì„œë¡œ êµí†µí•˜ëŠ” ê²ƒê³¼
ì£„ë¥¼ ì‚¬í•˜ì—¬ ì£¼ì‹œëŠ” ê²ƒê³¼
ëª¸ì´ ë‹¤ì‹œ ì‚¬ëŠ” ê²ƒê³¼
ì˜ì›íˆ ì‚¬ëŠ” ê²ƒì„ ë¯¿ì‚¬ì˜µë‚˜ì´ë‹¤

ì•„ë©˜`,
                tags: ['ì‹ ì•™ê³ ë°±', 'ê¸°ë³¸', 'ì‚¬ë„ì‹ ê²½']
            }
        };

        const prayer = corePreyers[prayerType];
        if (prayer) {
            document.getElementById('modalTitle').textContent = prayer.title;
            document.getElementById('modalContent').textContent = prayer.content;
            document.getElementById('modalTags').innerHTML = prayer.tags.map(tag => `
                <span class="inline-block bg-green-100 text-green-800 px-3 py-2 rounded-full text-base font-medium">${tag}</span>
            `).join('');
            document.getElementById('prayerModal').classList.remove('hidden');
        }
    };

    window.resetKeyword = function() {
        document.getElementById('keywordContent').classList.add('hidden');
        document.getElementById('keywordSelection').classList.remove('hidden');
        currentKeyword = null;
    };

    window.showPrayerDetail = function(index) {
        const prayer = window.prayersData[index];
        if (prayer) {
            document.getElementById('modalTitle').textContent = prayer.title;
            document.getElementById('modalContent').textContent = prayer.content;
            document.getElementById('modalTags').innerHTML = '';
            document.getElementById('prayerModal').classList.remove('hidden');
        }
    };

    window.showVerseDetail = async function(book, chapter) {
        try {
            const response = await fetch(`/api/bible/chapters/${book}/${chapter}`);
            const data = await response.json();

            document.getElementById('verseDetailTitle').textContent = `${data.book_name} ${chapter}ì¥`;
            document.getElementById('verseDetailVersion').textContent = 'ê°œì—­ê°œì •';
            document.getElementById('verseDetailContent').innerHTML = data.verses.map(verse =>
                `<span class="verse"><sup class="verse-number">${verse.verse}</sup> ${verse.content}</span>`
            ).join(' ');

            document.getElementById('verseDetailModal').classList.remove('hidden');
        } catch (error) {
            console.error('ì„±ê²½ ì¥ ë¡œë“œ ì‹¤íŒ¨:', error);
            BibleAI.showNotification('ì„±ê²½ ì¥ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
        }
    };

    window.showHymnDetail = function(hymnNumber) {
        window.open(`https://www.hymn21.net/hymn/hymn_view.php?song=${hymnNumber}`, '_blank');
    };

    window.closeVerseDetail = function() {
        document.getElementById('verseDetailModal').classList.add('hidden');
    };

    window.closePrayerModal = function() {
        document.getElementById('prayerModal').classList.add('hidden');
    };

    window.copyPrayer = function() {
        const content = document.getElementById('modalContent').textContent;
        navigator.clipboard.writeText(content).then(() => {
            BibleAI.showNotification('âœ… ê¸°ë„ë¬¸ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }).catch(() => {
            BibleAI.showNotification('âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
        });
    };

    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closePrayerModal();
            closeVerseDetail();
        }
    });

    // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
    document.getElementById('prayerModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closePrayerModal();
        }
    });

    document.getElementById('verseDetailModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeVerseDetail();
        }
    });
});
</script>
{{end}}